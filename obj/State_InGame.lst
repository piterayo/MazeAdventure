                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.5.5 #9498 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module State_InGame
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _ui_gamemenu_render_refresh
                             12 	.globl _ui_gamemenu_unselect_entry
                             13 	.globl _ui_gamemenu_select_entry
                             14 	.globl _ui_gamemenu_previous_entry
                             15 	.globl _ui_gamemenu_next_entry
                             16 	.globl _ui_gamemenu_is_selected
                             17 	.globl _ui_gamemenu_get_entry
                             18 	.globl _ui_gamemenu_init
                             19 	.globl _renderCompass
                             20 	.globl _level_load_level
                             21 	.globl _level_set_level
                             22 	.globl _draw_minimap_to_buffer
                             23 	.globl _render_draw_to_buffer
                             24 	.globl _generate_level
                             25 	.globl _statemanager_input_accepted
                             26 	.globl _statemanager_set_state
                             27 	.globl _cpct_drawSprite
                             28 	.globl _cpct_isKeyPressed
                             29 	.globl _cpct_memset
                             30 	.globl _updateRenderBuffer
                             31 	.globl _isInitialized
                             32 	.globl _state_ingame_enter
                             33 	.globl _state_ingame_input
                             34 	.globl _state_ingame_update
                             35 	.globl _state_ingame_render
                             36 	.globl _state_ingame_exit
                             37 ;--------------------------------------------------------
                             38 ; special function registers
                             39 ;--------------------------------------------------------
                             40 ;--------------------------------------------------------
                             41 ; ram data
                             42 ;--------------------------------------------------------
                             43 	.area _DATA
                             44 ;--------------------------------------------------------
                             45 ; ram data
                             46 ;--------------------------------------------------------
                             47 	.area _INITIALIZED
                             48 ;--------------------------------------------------------
                             49 ; absolute external ram data
                             50 ;--------------------------------------------------------
                             51 	.area _DABS (ABS)
                             52 ;--------------------------------------------------------
                             53 ; global & static initialisations
                             54 ;--------------------------------------------------------
                             55 	.area _HOME
                             56 	.area _GSINIT
                             57 	.area _GSFINAL
                             58 	.area _GSINIT
                             59 ;--------------------------------------------------------
                             60 ; Home
                             61 ;--------------------------------------------------------
                             62 	.area _HOME
                             63 	.area _HOME
                             64 ;--------------------------------------------------------
                             65 ; code
                             66 ;--------------------------------------------------------
                             67 	.area _CODE
                             68 ;src/State_InGame.c:22: void state_ingame_enter(){
                             69 ;	---------------------------------
                             70 ; Function state_ingame_enter
                             71 ; ---------------------------------
   0000                      72 _state_ingame_enter::
                             73 ;src/State_InGame.c:23: if(!isInitialized){
   0000 3Ar35r00      [13]   74 	ld	a,(#_isInitialized + 0)
   0003 B7            [ 4]   75 	or	a, a
   0004 20 1B         [12]   76 	jr	NZ,00102$
                             77 ;src/State_InGame.c:24: generate_level();
   0006 CDr00r00      [17]   78 	call	_generate_level
                             79 ;src/State_InGame.c:25: level_set_level(0);
   0009 AF            [ 4]   80 	xor	a, a
   000A F5            [11]   81 	push	af
   000B 33            [ 6]   82 	inc	sp
   000C CDr00r00      [17]   83 	call	_level_set_level
   000F 33            [ 6]   84 	inc	sp
                             85 ;src/State_InGame.c:26: level_load_level();
   0010 CDr00r00      [17]   86 	call	_level_load_level
                             87 ;src/State_InGame.c:28: ui_gamemenu_init();
   0013 CDr00r00      [17]   88 	call	_ui_gamemenu_init
                             89 ;src/State_InGame.c:30: render_draw_to_buffer();
   0016 CDr00r00      [17]   90 	call	_render_draw_to_buffer
                             91 ;src/State_InGame.c:31: draw_minimap_to_buffer();
   0019 CDr00r00      [17]   92 	call	_draw_minimap_to_buffer
                             93 ;src/State_InGame.c:32: *(u8*)&isInitialized = 1;
   001C 21r35r00      [10]   94 	ld	hl,#_isInitialized
   001F 36 01         [10]   95 	ld	(hl),#0x01
   0021                      96 00102$:
                             97 ;src/State_InGame.c:34: cpct_memset(CPCT_VMEM_START, g_colors[12], 0x4000);
   0021 21r0Cr00      [10]   98 	ld	hl,#_g_colors+12
   0024 46            [ 7]   99 	ld	b,(hl)
   0025 21 00 40      [10]  100 	ld	hl,#0x4000
   0028 E5            [11]  101 	push	hl
   0029 C5            [11]  102 	push	bc
   002A 33            [ 6]  103 	inc	sp
   002B 26 C0         [ 7]  104 	ld	h, #0xC0
   002D E5            [11]  105 	push	hl
   002E CDr00r00      [17]  106 	call	_cpct_memset
                            107 ;src/State_InGame.c:35: state_ingame_render();
   0031 CDr87r01      [17]  108 	call	_state_ingame_render
   0034 C9            [10]  109 	ret
   0035                     110 _isInitialized:
   0035 00                  111 	.db #0x00	; 0
   0036                     112 _updateRenderBuffer:
   0036 00                  113 	.db #0x00	; 0
                            114 ;src/State_InGame.c:38: void state_ingame_input(){
                            115 ;	---------------------------------
                            116 ; Function state_ingame_input
                            117 ; ---------------------------------
   0037                     118 _state_ingame_input::
                            119 ;src/State_InGame.c:40: if(cpct_isKeyPressed(Key_CursorLeft)){
   0037 21 01 01      [10]  120 	ld	hl,#0x0101
   003A CDr00r00      [17]  121 	call	_cpct_isKeyPressed
   003D 7D            [ 4]  122 	ld	a,l
   003E B7            [ 4]  123 	or	a, a
   003F 28 06         [12]  124 	jr	Z,00116$
                            125 ;src/State_InGame.c:41: ui_gamemenu_previous_entry();
   0041 CDr00r00      [17]  126 	call	_ui_gamemenu_previous_entry
                            127 ;src/State_InGame.c:42: statemanager_input_accepted();
   0044 C3r00r00      [10]  128 	jp  _statemanager_input_accepted
   0047                     129 00116$:
                            130 ;src/State_InGame.c:44: else if(cpct_isKeyPressed(Key_CursorRight)){
   0047 21 00 02      [10]  131 	ld	hl,#0x0200
   004A CDr00r00      [17]  132 	call	_cpct_isKeyPressed
   004D 7D            [ 4]  133 	ld	a,l
   004E B7            [ 4]  134 	or	a, a
   004F 28 06         [12]  135 	jr	Z,00113$
                            136 ;src/State_InGame.c:45: ui_gamemenu_next_entry();
   0051 CDr00r00      [17]  137 	call	_ui_gamemenu_next_entry
                            138 ;src/State_InGame.c:46: statemanager_input_accepted();
   0054 C3r00r00      [10]  139 	jp  _statemanager_input_accepted
   0057                     140 00113$:
                            141 ;src/State_InGame.c:48: else if(cpct_isKeyPressed(Key_Return)){
   0057 21 02 04      [10]  142 	ld	hl,#0x0402
   005A CDr00r00      [17]  143 	call	_cpct_isKeyPressed
   005D 7D            [ 4]  144 	ld	a,l
   005E B7            [ 4]  145 	or	a, a
   005F 28 06         [12]  146 	jr	Z,00110$
                            147 ;src/State_InGame.c:49: ui_gamemenu_select_entry();
   0061 CDr00r00      [17]  148 	call	_ui_gamemenu_select_entry
                            149 ;src/State_InGame.c:50: statemanager_input_accepted();
   0064 C3r00r00      [10]  150 	jp  _statemanager_input_accepted
   0067                     151 00110$:
                            152 ;src/State_InGame.c:53: else if(cpct_isKeyPressed(Key_1)){
   0067 21 08 01      [10]  153 	ld	hl,#0x0108
   006A CDr00r00      [17]  154 	call	_cpct_isKeyPressed
   006D 7D            [ 4]  155 	ld	a,l
   006E B7            [ 4]  156 	or	a, a
   006F 28 0D         [12]  157 	jr	Z,00107$
                            158 ;src/State_InGame.c:54: level_set_level(0);
   0071 AF            [ 4]  159 	xor	a, a
   0072 F5            [11]  160 	push	af
   0073 33            [ 6]  161 	inc	sp
   0074 CDr00r00      [17]  162 	call	_level_set_level
   0077 33            [ 6]  163 	inc	sp
                            164 ;src/State_InGame.c:55: level_load_level();
   0078 CDr00r00      [17]  165 	call	_level_load_level
                            166 ;src/State_InGame.c:56: statemanager_input_accepted();
   007B C3r00r00      [10]  167 	jp  _statemanager_input_accepted
   007E                     168 00107$:
                            169 ;src/State_InGame.c:58: else if(cpct_isKeyPressed(Key_2)){ 
   007E 21 08 02      [10]  170 	ld	hl,#0x0208
   0081 CDr00r00      [17]  171 	call	_cpct_isKeyPressed
   0084 7D            [ 4]  172 	ld	a,l
   0085 B7            [ 4]  173 	or	a, a
   0086 28 0E         [12]  174 	jr	Z,00104$
                            175 ;src/State_InGame.c:59: level_set_level(9);
   0088 3E 09         [ 7]  176 	ld	a,#0x09
   008A F5            [11]  177 	push	af
   008B 33            [ 6]  178 	inc	sp
   008C CDr00r00      [17]  179 	call	_level_set_level
   008F 33            [ 6]  180 	inc	sp
                            181 ;src/State_InGame.c:60: level_load_level();
   0090 CDr00r00      [17]  182 	call	_level_load_level
                            183 ;src/State_InGame.c:61: statemanager_input_accepted();
   0093 C3r00r00      [10]  184 	jp  _statemanager_input_accepted
   0096                     185 00104$:
                            186 ;src/State_InGame.c:63: else if(cpct_isKeyPressed(Key_T)){
   0096 21 06 08      [10]  187 	ld	hl,#0x0806
   0099 CDr00r00      [17]  188 	call	_cpct_isKeyPressed
   009C 7D            [ 4]  189 	ld	a,l
   009D B7            [ 4]  190 	or	a, a
   009E C8            [11]  191 	ret	Z
                            192 ;src/State_InGame.c:64: *(u8*)&g_texturedWalls = !g_texturedWalls;
   009F 3Ar00r00      [13]  193 	ld	a,(#_g_texturedWalls + 0)
   00A2 D6 01         [ 7]  194 	sub	a,#0x01
   00A4 3E 00         [ 7]  195 	ld	a,#0x00
   00A6 17            [ 4]  196 	rla
   00A7 4F            [ 4]  197 	ld	c,a
   00A8 21r00r00      [10]  198 	ld	hl,#_g_texturedWalls
   00AB 71            [ 7]  199 	ld	(hl),c
                            200 ;src/State_InGame.c:65: statemanager_input_accepted();
   00AC C3r00r00      [10]  201 	jp  _statemanager_input_accepted
                            202 ;src/State_InGame.c:69: void state_ingame_update(){
                            203 ;	---------------------------------
                            204 ; Function state_ingame_update
                            205 ; ---------------------------------
   00AF                     206 _state_ingame_update::
                            207 ;src/State_InGame.c:71: if(ui_gamemenu_is_selected()){
   00AF CDr00r00      [17]  208 	call	_ui_gamemenu_is_selected
   00B2 7D            [ 4]  209 	ld	a,l
   00B3 B7            [ 4]  210 	or	a, a
   00B4 CAr76r01      [10]  211 	jp	Z,00109$
                            212 ;src/State_InGame.c:72: ui_gamemenu_render_refresh();
   00B7 CDr00r00      [17]  213 	call	_ui_gamemenu_render_refresh
                            214 ;src/State_InGame.c:73: switch(ui_gamemenu_get_entry()){
   00BA CDr00r00      [17]  215 	call	_ui_gamemenu_get_entry
   00BD 5D            [ 4]  216 	ld	e,l
   00BE 3E 05         [ 7]  217 	ld	a,#0x05
   00C0 93            [ 4]  218 	sub	a, e
   00C1 DAr73r01      [10]  219 	jp	C,00107$
                            220 ;src/State_InGame.c:75: *(u8*)&(PLAYER_directionIndex)=(PLAYER_directionIndex+2)&7;
   00C4 FD 21r00r00   [14]  221 	ld	iy,#_PLAYER_directionIndex
   00C8 FD 4E 00      [19]  222 	ld	c,0 (iy)
                            223 ;src/State_InGame.c:73: switch(ui_gamemenu_get_entry()){
   00CB 16 00         [ 7]  224 	ld	d,#0x00
   00CD 21rD4r00      [10]  225 	ld	hl,#00126$
   00D0 19            [11]  226 	add	hl,de
   00D1 19            [11]  227 	add	hl,de
   00D2 19            [11]  228 	add	hl,de
   00D3 E9            [ 4]  229 	jp	(hl)
   00D4                     230 00126$:
   00D4 C3rE6r00      [10]  231 	jp	00101$
   00D7 C3r18r01      [10]  232 	jp	00102$
   00DA C3r39r01      [10]  233 	jp	00103$
   00DD C3r73r01      [10]  234 	jp	00107$
   00E0 C3r73r01      [10]  235 	jp	00107$
   00E3 C3r6Br01      [10]  236 	jp	00106$
                            237 ;src/State_InGame.c:74: case 0:{
   00E6                     238 00101$:
                            239 ;src/State_InGame.c:75: *(u8*)&(PLAYER_directionIndex)=(PLAYER_directionIndex+2)&7;
   00E6 11r00r00      [10]  240 	ld	de,#_PLAYER_directionIndex+0
   00E9 0C            [ 4]  241 	inc	c
   00EA 0C            [ 4]  242 	inc	c
   00EB 79            [ 4]  243 	ld	a,c
   00EC E6 07         [ 7]  244 	and	a, #0x07
   00EE 12            [ 7]  245 	ld	(de),a
                            246 ;src/State_InGame.c:76: *(i8*)&(PLAYER_direction.x) = PLAYER_directionArray[(PLAYER_directionIndex)];
   00EF 01r00r00      [10]  247 	ld	bc,#_PLAYER_direction+0
   00F2 11r00r00      [10]  248 	ld	de,#_PLAYER_directionArray+0
   00F5 FD 21r00r00   [14]  249 	ld	iy,#_PLAYER_directionIndex
   00F9 FD 6E 00      [19]  250 	ld	l,0 (iy)
   00FC 26 00         [ 7]  251 	ld	h,#0x00
   00FE 19            [11]  252 	add	hl,de
   00FF 7E            [ 7]  253 	ld	a,(hl)
   0100 02            [ 7]  254 	ld	(bc),a
                            255 ;src/State_InGame.c:77: *(i8*)&(PLAYER_direction.y) = PLAYER_directionArray[((PLAYER_directionIndex)+1)];
   0101 01r01r00      [10]  256 	ld	bc,#_PLAYER_direction+1
   0104 FD 21r00r00   [14]  257 	ld	iy,#_PLAYER_directionIndex
   0108 FD 6E 00      [19]  258 	ld	l,0 (iy)
   010B 2C            [ 4]  259 	inc	l
   010C 26 00         [ 7]  260 	ld	h,#0x00
   010E 19            [11]  261 	add	hl,de
   010F 7E            [ 7]  262 	ld	a,(hl)
   0110 02            [ 7]  263 	ld	(bc),a
                            264 ;src/State_InGame.c:79: *(u8*)&updateRenderBuffer = 1;
   0111 21r36r00      [10]  265 	ld	hl,#_updateRenderBuffer
   0114 36 01         [10]  266 	ld	(hl),#0x01
                            267 ;src/State_InGame.c:80: break;
   0116 18 5B         [12]  268 	jr	00107$
                            269 ;src/State_InGame.c:82: case 1:{
   0118                     270 00102$:
                            271 ;src/State_InGame.c:83: *(i8*)&(PLAYER_position.x) = PLAYER_position.x + PLAYER_direction.x;
   0118 21r00r00      [10]  272 	ld	hl,#_PLAYER_position+0
   011B 4D            [ 4]  273 	ld	c, l
   011C 44            [ 4]  274 	ld	b, h
   011D 5E            [ 7]  275 	ld	e,(hl)
   011E 21r00r00      [10]  276 	ld	hl,#_PLAYER_direction+0
   0121 56            [ 7]  277 	ld	d,(hl)
   0122 7B            [ 4]  278 	ld	a,e
   0123 82            [ 4]  279 	add	a, d
   0124 02            [ 7]  280 	ld	(bc),a
                            281 ;src/State_InGame.c:84: *(i8*)&(PLAYER_position.y) = PLAYER_position.y + PLAYER_direction.y;
   0125 21r01r00      [10]  282 	ld	hl,#_PLAYER_position+1
   0128 4D            [ 4]  283 	ld	c, l
   0129 44            [ 4]  284 	ld	b, h
   012A 5E            [ 7]  285 	ld	e,(hl)
   012B 21r01r00      [10]  286 	ld	hl,#_PLAYER_direction+1
   012E 56            [ 7]  287 	ld	d,(hl)
   012F 7B            [ 4]  288 	ld	a,e
   0130 82            [ 4]  289 	add	a, d
   0131 02            [ 7]  290 	ld	(bc),a
                            291 ;src/State_InGame.c:86: *(u8*)&updateRenderBuffer = 1;
   0132 21r36r00      [10]  292 	ld	hl,#_updateRenderBuffer
   0135 36 01         [10]  293 	ld	(hl),#0x01
                            294 ;src/State_InGame.c:87: break;
   0137 18 3A         [12]  295 	jr	00107$
                            296 ;src/State_InGame.c:89: case 2:{
   0139                     297 00103$:
                            298 ;src/State_InGame.c:90: *(u8*)&(PLAYER_directionIndex)=(PLAYER_directionIndex-2)&7;
   0139 11r00r00      [10]  299 	ld	de,#_PLAYER_directionIndex+0
   013C 0D            [ 4]  300 	dec	c
   013D 0D            [ 4]  301 	dec	c
   013E 79            [ 4]  302 	ld	a,c
   013F E6 07         [ 7]  303 	and	a, #0x07
   0141 12            [ 7]  304 	ld	(de),a
                            305 ;src/State_InGame.c:91: *(i8*)&(PLAYER_direction.x) = PLAYER_directionArray[(PLAYER_directionIndex)];
   0142 01r00r00      [10]  306 	ld	bc,#_PLAYER_direction+0
   0145 11r00r00      [10]  307 	ld	de,#_PLAYER_directionArray+0
   0148 FD 21r00r00   [14]  308 	ld	iy,#_PLAYER_directionIndex
   014C FD 6E 00      [19]  309 	ld	l,0 (iy)
   014F 26 00         [ 7]  310 	ld	h,#0x00
   0151 19            [11]  311 	add	hl,de
   0152 7E            [ 7]  312 	ld	a,(hl)
   0153 02            [ 7]  313 	ld	(bc),a
                            314 ;src/State_InGame.c:92: *(i8*)&(PLAYER_direction.y) = PLAYER_directionArray[((PLAYER_directionIndex)+1)];
   0154 01r01r00      [10]  315 	ld	bc,#_PLAYER_direction+1
   0157 FD 21r00r00   [14]  316 	ld	iy,#_PLAYER_directionIndex
   015B FD 6E 00      [19]  317 	ld	l,0 (iy)
   015E 2C            [ 4]  318 	inc	l
   015F 26 00         [ 7]  319 	ld	h,#0x00
   0161 19            [11]  320 	add	hl,de
   0162 7E            [ 7]  321 	ld	a,(hl)
   0163 02            [ 7]  322 	ld	(bc),a
                            323 ;src/State_InGame.c:94: *(u8*)&updateRenderBuffer = 1;
   0164 21r36r00      [10]  324 	ld	hl,#_updateRenderBuffer
                            325 ;src/State_InGame.c:95: break;
                            326 ;src/State_InGame.c:97: case 3:{
                            327 ;src/State_InGame.c:99: break;
                            328 ;src/State_InGame.c:101: case 4:{
                            329 ;src/State_InGame.c:103: break;
   0167 36 01         [10]  330 	ld	(hl), #0x01
   0169 18 08         [12]  331 	jr	00107$
                            332 ;src/State_InGame.c:105: case 5:{
   016B                     333 00106$:
                            334 ;src/State_InGame.c:106: statemanager_set_state(STATE_PAUSEMENU);
   016B 3E 02         [ 7]  335 	ld	a,#0x02
   016D F5            [11]  336 	push	af
   016E 33            [ 6]  337 	inc	sp
   016F CDr00r00      [17]  338 	call	_statemanager_set_state
   0172 33            [ 6]  339 	inc	sp
                            340 ;src/State_InGame.c:109: }
   0173                     341 00107$:
                            342 ;src/State_InGame.c:110: ui_gamemenu_unselect_entry();
   0173 CDr00r00      [17]  343 	call	_ui_gamemenu_unselect_entry
   0176                     344 00109$:
                            345 ;src/State_InGame.c:113: if(updateRenderBuffer){
   0176 3Ar36r00      [13]  346 	ld	a,(#_updateRenderBuffer + 0)
   0179 B7            [ 4]  347 	or	a, a
   017A C8            [11]  348 	ret	Z
                            349 ;src/State_InGame.c:114: render_draw_to_buffer();
   017B CDr00r00      [17]  350 	call	_render_draw_to_buffer
                            351 ;src/State_InGame.c:115: draw_minimap_to_buffer();
   017E CDr00r00      [17]  352 	call	_draw_minimap_to_buffer
                            353 ;src/State_InGame.c:116: *(u8*)&updateRenderBuffer = 0;
   0181 21r36r00      [10]  354 	ld	hl,#_updateRenderBuffer
   0184 36 00         [10]  355 	ld	(hl),#0x00
   0186 C9            [10]  356 	ret
                            357 ;src/State_InGame.c:121: void state_ingame_render(){
                            358 ;	---------------------------------
                            359 ; Function state_ingame_render
                            360 ; ---------------------------------
   0187                     361 _state_ingame_render::
                            362 ;src/State_InGame.c:122: ui_gamemenu_render_refresh();
   0187 CDr00r00      [17]  363 	call	_ui_gamemenu_render_refresh
                            364 ;src/State_InGame.c:123: cpct_drawSprite(SCREEN_TEXTURE_BUFFER,SCREEN_TEXTURE_POSITION,SCREEN_TEXTURE_WIDTH_BYTES,SCREEN_TEXTURE_HEIGHT);
   018A 21 28 64      [10]  365 	ld	hl,#0x6428
   018D E5            [11]  366 	push	hl
   018E 21 B4 C0      [10]  367 	ld	hl,#0xC0B4
   0191 E5            [11]  368 	push	hl
   0192 21 00 8B      [10]  369 	ld	hl,#0x8B00
   0195 E5            [11]  370 	push	hl
   0196 CDr00r00      [17]  371 	call	_cpct_drawSprite
                            372 ;src/State_InGame.c:124: renderCompass();
   0199 CDr00r00      [17]  373 	call	_renderCompass
                            374 ;src/State_InGame.c:125: cpct_drawSprite(MINIMAP_BUFFER,MINIMAP_POSITION,MINIMAP_WIDTH_BYTES,MINIMAP_HEIGHT_BYTES);
   019C 21 10 40      [10]  375 	ld	hl,#0x4010
   019F E5            [11]  376 	push	hl
   01A0 21 70 C5      [10]  377 	ld	hl,#0xC570
   01A3 E5            [11]  378 	push	hl
   01A4 21 A0 9A      [10]  379 	ld	hl,#0x9AA0
   01A7 E5            [11]  380 	push	hl
   01A8 CDr00r00      [17]  381 	call	_cpct_drawSprite
   01AB C9            [10]  382 	ret
                            383 ;src/State_InGame.c:128: void state_ingame_exit(){
                            384 ;	---------------------------------
                            385 ; Function state_ingame_exit
                            386 ; ---------------------------------
   01AC                     387 _state_ingame_exit::
                            388 ;src/State_InGame.c:129: *(u8*)&isInitialized = 0;
   01AC 21r35r00      [10]  389 	ld	hl,#_isInitialized
   01AF 36 00         [10]  390 	ld	(hl),#0x00
   01B1 C9            [10]  391 	ret
                            392 	.area _CODE
                            393 	.area _INITIALIZER
                            394 	.area _CABS (ABS)
